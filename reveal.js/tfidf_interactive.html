<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive TF-IDF Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Sans Pro', Helvetica, sans-serif;
            background: #191919;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            text-align: center;
            width: 100%;
        }
        
        .documents {
            display: flex;
            justify-content: center;
            gap: 30px 60px;
            margin-bottom: 80px;
            flex-wrap: wrap;
            position: relative;
        }
        
        .document {
            position: relative;
            padding: 20px;
            border-radius: 8px;
            font-size: 48px;
            min-width: 200px;
        }
        
        .sliding-border {
            position: absolute;
            border: 3px solid #0CD4FF;
            border-radius: 8px;
            transition: all 0.8s ease;
            pointer-events: none;
        }
        
        .word {
            cursor: pointer;
            transition: color 0.6s ease;
            margin-right: 8px;
        }
        
        .word:hover {
            cursor: pointer;
        }
        
        .word.selected {
            color: #FF3A06;
        }
        
        .word.first-occurrence {
            border-bottom: 4px solid #8DFF0A;
            padding-bottom: 4px;
            animation: fadeInUnderline 0.6s ease;
        }
        
        .word-input {
            background: #333;
            border: 2px solid #0CD4FF;
            border-radius: 4px;
            padding: 0;
            color: white;
            font-size: inherit;
            font-family: inherit;
            outline: none;
            text-align: center;
            box-sizing: border-box;
        }
        
        .equation {
            font-size: 56px;
            text-align: center;
            line-height: 1.6;
        }
        
        .term {
            color: white;
            transition: color 0.6s ease;
        }
        
        .doc-ref {
            color: #0CD4FF;
            transition: color 0.6s ease;
        }
        
        .tf-value {
            color: #FF3A06;
            transition: color 0.6s ease;
        }
        
        .df-value {
            color: #8DFF0A;
            transition: color 0.6s ease;
        }
        
        @keyframes fadeInUnderline {
            from { border-bottom-color: transparent; }
            to { border-bottom-color: #8DFF0A; }
        }
        
        @media (max-width: 768px) {
            .documents {
                flex-direction: column;
                gap: 30px;
                align-items: center;
            }
            
            .document {
                font-size: 36px;
            }
            
            .equation {
                font-size: 42px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="documents">
            <div class="sliding-border" id="sliding-border"></div>
            <div class="document" data-doc="0">
                <span class="word" data-word="very" data-doc="0">very</span>
                <span class="word" data-word="very" data-doc="0">very</span>
                <span class="word" data-word="hot" data-doc="0">hot</span>
            </div>
            <div class="document" data-doc="1">
                <span class="word" data-word="hot" data-doc="1">hot</span>
                <span class="word" data-word="new" data-doc="1">new</span>
                <span class="word" data-word="song" data-doc="1">song</span>
            </div>
            <div class="document" data-doc="2">
                <span class="word" data-word="very" data-doc="2">very</span>
                <span class="word" data-word="new" data-doc="2">new</span>
                <span class="word" data-word="song" data-doc="2">song</span>
            </div>
        </div>
        
        <div class="equation">
            <div>TF-IDF(<span class="term" id="term-display">hot</span>, <span class="doc-ref" id="doc-display">d<sub>1</sub></span>) = <span class="tf-value" id="tf-display">1</span> Ã— log(3/<span class="df-value" id="df-display">2</span>) = <span id="result-display">0.18</span></div>
        </div>
    </div>

    <script>
        const documents = [
            ["very", "very", "hot"],
            ["hot", "new", "song"], 
            ["very", "new", "song"]
        ];
        
        let selectedTerm = "hot";
        let selectedDoc = 0;
        
        function updateDisplay() {
            // Clear all selections
            document.querySelectorAll('.word').forEach(word => {
                word.classList.remove('selected', 'first-occurrence');
            });
            
            // Position sliding border
            const selectedDocElement = document.querySelector(`.document[data-doc="${selectedDoc}"]`);
            const slidingBorder = document.getElementById('sliding-border');
            
            if (selectedDocElement && slidingBorder) {
                const rect = selectedDocElement.getBoundingClientRect();
                const containerRect = selectedDocElement.parentElement.getBoundingClientRect();
                
                slidingBorder.style.left = (selectedDocElement.offsetLeft) + 'px';
                slidingBorder.style.top = (selectedDocElement.offsetTop) + 'px';
                slidingBorder.style.width = selectedDocElement.offsetWidth + 'px';
                slidingBorder.style.height = selectedDocElement.offsetHeight + 'px';
            }
            
            // Highlight selected term only in selected document
            if (selectedDocElement) {
                selectedDocElement.querySelectorAll(`.word[data-word="${selectedTerm}"]`).forEach(word => {
                    word.classList.add('selected');
                });
            }
            
            // Highlight selected document
            document.querySelector(`.document[data-doc="${selectedDoc}"]`).classList.add('selected');
            
            // Add green underlines to first occurrences
            documents.forEach((doc, docIndex) => {
                const firstIndex = doc.indexOf(selectedTerm);
                if (firstIndex !== -1) {
                    const wordElements = document.querySelectorAll(`.word[data-doc="${docIndex}"]`);
                    if (wordElements[firstIndex]) {
                        wordElements[firstIndex].classList.add('first-occurrence');
                    }
                }
            });
            
            // Update equation
            const tf = getTF(selectedTerm, selectedDoc);
            const df = getDF(selectedTerm);
            const idf = Math.log(3 / df);
            const tfidf = tf * idf;
            
            document.getElementById('term-display').textContent = selectedTerm;
            document.getElementById('doc-display').innerHTML = `d<sub>${selectedDoc + 1}</sub>`;
            document.getElementById('tf-display').textContent = tf;
            document.getElementById('df-display').textContent = df;
            document.getElementById('result-display').textContent = tfidf.toFixed(2);
        }
        
        function getTF(term, docIndex) {
            return documents[docIndex].filter(word => word === term).length;
        }
        
        function getDF(term) {
            return documents.filter(doc => doc.includes(term)).length;
        }
        
        // Add click listeners
        document.querySelectorAll('.word').forEach(word => {
            // Single click - select word
            word.addEventListener('click', function() {
                const clickedTerm = this.dataset.word;
                const clickedDoc = parseInt(this.dataset.doc);
                
                // Check if anything actually changed
                const termChanged = clickedTerm !== selectedTerm;
                const docChanged = clickedDoc !== selectedDoc;
                
                // Only update if something changed
                if (termChanged || docChanged) {
                    selectedTerm = clickedTerm;
                    
                    if (clickedDoc !== selectedDoc) {
                        selectedDoc = clickedDoc;
                    }
                    
                    updateDisplay();
                }
            });
            
            // Double click - edit word
            word.addEventListener('dblclick', function(e) {
                e.preventDefault();
                editWord(this);
            });
        });
        
        function editWord(wordElement) {
            const currentText = wordElement.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentText;
            input.className = 'word-input';
            
            // Check if word has green underline styling
            const hasUnderline = wordElement.classList.contains('first-occurrence');
            
            // Get exact position and dimensions
            const rect = wordElement.getBoundingClientRect();
            const containerRect = wordElement.parentNode.getBoundingClientRect();
            
            // Set input to exactly match word position and size
            input.style.position = 'absolute';
            input.style.left = (rect.left - containerRect.left - 10) + 'px';
            input.style.top = (rect.top - containerRect.top) + 'px';
            input.style.width = (rect.width + 20) + 'px';
            input.style.height = rect.height + 'px';
            input.style.zIndex = '10';
            input.style.margin = '0';
            input.style.border = '2px solid #0CD4FF';
            input.style.borderRadius = '4px';
            
            // Match underline styling if present
            if (hasUnderline) {
                input.style.borderBottom = '4px solid #8DFF0A';
                input.style.paddingBottom = '4px';
            }
            
            // Replace word with input
            wordElement.style.visibility = 'hidden';
            wordElement.parentNode.appendChild(input);
            input.focus();
            input.select();
            
            function finishEdit(save = true) {
                if (save && input.value.trim()) {
                    const newWord = input.value.trim();
                    const docIndex = parseInt(wordElement.dataset.doc);
                    const wordIndex = Array.from(wordElement.parentNode.children)
                        .filter(el => el.classList.contains('word'))
                        .indexOf(wordElement);
                    
                    // Update data
                    documents[docIndex][wordIndex] = newWord;
                    wordElement.textContent = newWord;
                    wordElement.dataset.word = newWord;
                    
                    // Update selected term if this was the selected word
                    if (wordElement.classList.contains('selected')) {
                        selectedTerm = newWord;
                    }
                }
                
                // Remove input and show word
                input.remove();
                wordElement.style.visibility = 'visible';
                
                if (save) {
                    updateDisplay();
                }
            }
            
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    finishEdit(true);
                } else if (e.key === 'Escape') {
                    finishEdit(false);
                }
            });
            
            input.addEventListener('blur', function() {
                finishEdit(true);
            });
        }
        
        // Initialize display
        window.addEventListener('load', () => {
            updateDisplay();
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            updateDisplay();
        });
    </script>
</body>
</html>
